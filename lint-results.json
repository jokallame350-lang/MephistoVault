[{"filePath":"C:\\Users\\pc\\Desktop\\projelerim\\mephisto-share\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\pc\\Desktop\\projelerim\\mephisto-share\\src\\App.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":112,"column":99,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":102,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6364,6367],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6364,6367],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":162,"column":91,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":162,"endColumn":94,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8651,8654],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8651,8654],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":219,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":219,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10995,10998],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10995,10998],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":245,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":245,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12550,12553],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12550,12553],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'finalizeDownload' and 't'. Either include them or remove the dependency array.","line":254,"column":6,"nodeType":"ArrayExpression","endLine":254,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [finalizeDownload, t]","fix":{"range":[12916,12918],"text":"[finalizeDownload, t]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'isConnected' and 'transferProgress'. Either include them or remove the dependency array.","line":297,"column":6,"nodeType":"ArrayExpression","endLine":297,"endColumn":31,"suggestions":[{"desc":"Update the dependencies array to be: [isConnected, transferProgress]","fix":{"range":[14116,14141],"text":"[isConnected, transferProgress]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a complex expression in the dependency array. Extract it to a separate variable so it can be statically checked.","line":297,"column":7,"nodeType":"BinaryExpression","endLine":297,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":395,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":395,"endColumn":15},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":422,"column":67,"nodeType":"BlockStatement","messageId":"unexpected","endLine":422,"endColumn":70,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[18332,18333],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":426,"column":81,"nodeType":"BlockStatement","messageId":"unexpected","endLine":426,"endColumn":84,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[18581,18582],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":463,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":463,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19611,19614],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19611,19614],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":529,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":529,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21692,21695],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21692,21695],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'initSender'. Either include it or remove the dependency array.","line":539,"column":6,"nodeType":"ArrayExpression","endLine":539,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [initSender, mode, shareCode]","fix":{"range":[21935,21952],"text":"[initSender, mode, shareCode]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":581,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":581,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23301,23304],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23301,23304],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":617,"column":127,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":617,"endColumn":130,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24887,24890],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24887,24890],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":617,"column":176,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":617,"endColumn":179,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24936,24939],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24936,24939],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":640,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":640,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25880,25883],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25880,25883],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":677,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":677,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27070,27073],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27070,27073],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":725,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":725,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28590,28593],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28590,28593],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":725,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":725,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28623,28626],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28623,28626],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":727,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":727,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28684,28687],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28684,28687],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":729,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":729,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28762,28765],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28762,28765],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":735,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":735,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28954,28957],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28954,28957],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":737,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":737,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29038,29041],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29038,29041],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":738,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":738,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29098,29101],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29098,29101],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":762,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":762,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29774,29777],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29774,29777],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":765,"column":84,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":765,"endColumn":87,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29939,29942],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29939,29942],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":765,"column":111,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":765,"endColumn":114,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29966,29969],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29966,29969],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":810,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":810,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31405,31408],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31405,31408],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":842,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":842,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[33113,33116],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[33113,33116],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":858,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":858,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[33547,33550],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[33547,33550],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":860,"column":83,"nodeType":"BlockStatement","messageId":"unexpected","endLine":860,"endColumn":86,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[33667,33668],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":892,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":892,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[34665,34668],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[34665,34668],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1081,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1081,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[45329,45332],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[45329,45332],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1304,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1304,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[58573,58576],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[58573,58576],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1312,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1312,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[59065,59068],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[59065,59068],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":32,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { Upload, Download, Activity, Shield, X, Copy, Check, File as FileIcon, Loader2, MessageSquare, Send, Lock, Sun, Moon, Clock, Smile, Clipboard, QrCode, Globe, Bomb, Wifi, Play, Radio, Users, Folder } from 'lucide-react';\nimport { motion, AnimatePresence, animate } from 'framer-motion';\nimport { Peer } from 'peerjs';\nimport type { DataConnection } from 'peerjs';\nimport JSZip from 'jszip';\nimport { QRCodeSVG } from 'qrcode.react';\n\nconst CHUNK_SIZE = 16 * 1024;\nconst SELF_DESTRUCT_SEC = 30;\n\nconst i18n: Record<string, Record<string, string>> = {\n  en: {\n    title: 'MephistoShare', subtitle: 'Zero-knowledge, peer-to-peer file transfer.',\n    subtitle2: 'No servers. No limits. No logs.',\n    sendFiles: 'Send Files', receiveFiles: 'Receive Files',\n    sendDesc: 'Generate link & send', receiveDesc: 'Enter code to download',\n    sendTitle: 'Send a File', receiveTitle: 'Receive Files',\n    dropHere: 'Click or drop files here', dropHot: \"Drop it like it's hot!\",\n    dropSub: \"Select multiple files, we'll zip them instantly\",\n    shareCode: 'Share this code with the receiver', connCode: 'Connection Code',\n    connect: 'Connect', waiting: 'Waiting for receiver connection...',\n    connecting: 'Connecting to sender & requesting file...',\n    sending: 'Sending & Encrypting...', receiving: 'Decrypting & Receiving...',\n    complete: 'Transfer Complete!', save: 'Save', compressing: 'Compressing Files...',\n    compressSub: 'Locking multiple files into an encrypted bundle.',\n    e2eNote: 'Once connected, files are transferred securely via WebRTC. The transfer is end-to-end encrypted and never passes through any storage servers.',\n    ghostChat: 'E2E Ghost Chat', secure: 'Secure',\n    chatPlaceholder: 'Type a secure message...', chatEmpty: 'Messages are peer-to-peer and vanish when closed.',\n    footer: 'E2E Encrypted ÔÇó Open Source ÔÇó Free',\n    errorPeer: 'Error: Could not find or connect to that peer. Check the code.',\n    connLost: 'Connection lost.', connClosed: 'Connection closed unexpectedly.',\n    selfDestruct: 'Self-destructing in', readySave: 'File is ready to be saved to your device.',\n    connected: 'Connected',\n    nearby: 'Nearby Devices', noNearby: 'No nearby devices found yet. Open MephistoShare in another tab!',\n    selectFolder: 'Select Folder', dropSubFolder: 'Drag and drop files or folders here',\n    streamPlay: 'Play Video', streamTitle: 'Stream Preview',\n    peers: 'peers connected', roomTitle: 'Multi-Peer Room',\n    swarmMode: 'Swarm Mode', beSeeder: 'Become Seeder', seeding: 'Seeding to peers...',\n    swarmDesc: 'After downloading, become a seeder to help others download faster!',\n    sendTo: 'Connect', waitingFile: 'Select a file first, then hit Send',\n  },\n  tr: {\n    title: 'MephistoShare', subtitle: 'S─▒f─▒r bilgi, e┼şler aras─▒ dosya transferi.',\n    subtitle2: 'Sunucu yok. Limit yok. Log yok.',\n    sendFiles: 'Dosya G├Ânder', receiveFiles: 'Dosya Al',\n    sendDesc: 'Ba─şlant─▒ olu┼ştur ve g├Ânder', receiveDesc: 'Kod girerek indir',\n    sendTitle: 'Dosya G├Ânder', receiveTitle: 'Dosya Al',\n    dropHere: 'Dosyalar─▒ s├╝r├╝kle veya t─▒kla', dropHot: 'B─▒rak gitsin!',\n    dropSub: 'Birden fazla dosya se├ğersen otomatik ZIP\\'leriz',\n    shareCode: 'Bu kodu al─▒c─▒yla payla┼ş', connCode: 'Ba─şlant─▒ Kodu',\n    connect: 'Ba─şlan', waiting: 'Al─▒c─▒ ba─şlant─▒s─▒ bekleniyor...',\n    connecting: 'G├Ândericiye ba─şlan─▒l─▒yor & dosya isteniyor...',\n    sending: 'G├Ânderiliyor & ┼Şifreleniyor...', receiving: '┼Şifre ├ç├Âz├╝l├╝yor & Al─▒n─▒yor...',\n    complete: 'Transfer Tamamland─▒!', save: 'Kaydet', compressing: 'Dosyalar S─▒k─▒┼şt─▒r─▒l─▒yor...',\n    compressSub: 'Birden fazla dosya ┼şifreli pakete d├Ân├╝┼şt├╝r├╝l├╝yor.',\n    e2eNote: 'Ba─şland─▒─ş─▒n─▒zda dosyalar WebRTC ile g├╝venli olarak iletilir. Transfer u├ğtan uca ┼şifrelidir ve hi├ğbir sunucu ├╝zerinden ge├ğmez.',\n    ghostChat: 'E2E Hayalet Sohbet', secure: 'G├╝venli',\n    chatPlaceholder: 'G├╝venli mesaj yaz...', chatEmpty: 'Mesajlar P2P iletilir ve kapan─▒nca yok olur.',\n    footer: 'U├ğtan Uca ┼Şifreli ÔÇó A├ğ─▒k Kaynak ÔÇó ├£cretsiz',\n    errorPeer: 'Hata: Kar┼ş─▒ taraf bulunamad─▒. Kodu kontrol edin.',\n    connLost: 'Ba─şlant─▒ koptu.', connClosed: 'Ba─şlant─▒ beklenmedik ┼şekilde kapand─▒.',\n    selfDestruct: 'Kendini imha:', readySave: 'Dosya kaydedilmeye haz─▒r.',\n    connected: 'Ba─şl─▒',\n    nearby: 'Yak─▒ndaki Cihazlar', noNearby: 'Hen├╝z yak─▒nda cihaz bulunamad─▒. MephistoShare\\'i ba┼şka bir sekmede a├ğ!',\n    streamPlay: 'Videoyu Oynat', streamTitle: 'Ak─▒┼ş ├ûnizleme',\n    peers: 'ba─şl─▒ cihaz', roomTitle: '├çoklu Cihaz Odas─▒',\n    swarmMode: 'Swarm Modu', beSeeder: 'Seeder Ol', seeding: 'Di─şer cihazlara g├Ânderiliyor...',\n    swarmDesc: 'Dosyay─▒ indirdikten sonra seeder olarak ba┼şkalar─▒n─▒n daha h─▒zl─▒ indirmesine yard─▒m et!',\n    sendTo: 'Ba─şlan', waitingFile: '├ûnce dosya se├ğ, sonra G├Ânder\\'e bas',\n    selectFolder: 'Klas├Âr Se├ğ', dropSubFolder: 'Dosyalar─▒ ya da Klas├Ârleri s├╝r├╝kleyin',\n  }\n};\n\nfunction generateCode() {\n  const chars = 'abcdefghjkmnpqrstuvwxyz23456789';\n  let str = '';\n  for (let i = 0; i < 6; i++) {\n    str += chars.charAt(Math.floor(Math.random() * chars.length));\n  }\n  const pin = Math.floor(1000 + Math.random() * 9000);\n  return `${str.substring(0, 3)}-${str.substring(3, 6)}#${pin}`;\n}\n\nfunction AnimatedCounter({ value, className }: { value: number, className?: string }) {\n  const nodeRef = useRef<HTMLSpanElement>(null);\n  useEffect(() => {\n    const node = nodeRef.current;\n    if (node) {\n      const controls = animate(parseInt(node.textContent || '0'), value, {\n        duration: 0.5,\n        onUpdate(v) { node.textContent = Math.round(v).toString() + '%'; }\n      });\n      return () => controls.stop();\n    }\n  }, [value]);\n  return <span ref={nodeRef} className={className}>{value}%</span>;\n}\n\nfunction formatBytes(bytes: number, decimals = 2) {\n  if (!+bytes) return '0 Bytes';\n  const k = 1024;\n  const dm = decimals < 0 ? 0 : decimals;\n  const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  return `${parseFloat((bytes / Math.pow(k, i)).toFixed(dm))} ${sizes[i]}`;\n}\n\nfunction App() {\n  const [mode, setMode] = useState<'idle' | 'send' | 'receive'>('idle');\n  const [copied, setCopied] = useState(false);\n  const [theme, setTheme] = useState<'dark' | 'light'>(() => (localStorage.getItem('ms-theme') as any) || 'dark');\n\n  // PeerJS State\n  const peerRef = useRef<Peer | null>(null);\n  const connRef = useRef<DataConnection | null>(null);\n  const multiConnsRef = useRef<DataConnection[]>([]); // Multi-peer room\n  const [peerCount, setPeerCount] = useState(0);\n\n  const [shareCode, setShareCode] = useState<string>('');\n  const [receiveCode, setReceiveCode] = useState<string>('');\n  const [isConnected, setIsConnected] = useState(false);\n  const [errorStatus, setErrorStatus] = useState<string | null>(null);\n\n  const [fileToShare, setFileToShare] = useState<File | null>(null);\n  const fileToShareRef = useRef<File | null>(null);\n  const [transferProgress, setTransferProgress] = useState(-1);\n  const [fileMeta, setFileMeta] = useState<{ name: string, size: number, type: string } | null>(null);\n  const fileMetaRef = useRef<{ name: string, size: number, type: string } | null>(null);\n  const [isZipping, setIsZipping] = useState(false);\n  const [zipProgress, setZipProgress] = useState(0);\n  const [isDragging, setIsDragging] = useState(false);\n\n  // Chat State\n  const [chatMessages, setChatMessages] = useState<{ id: number, text: string, sender: 'me' | 'peer', emoji?: string }[]>([]);\n  const [chatInput, setChatInput] = useState('');\n  const [showEmojiPicker, setShowEmojiPicker] = useState(false);\n\n  // Receiver chunks\n  const receivedChunksRef = useRef<ArrayBuffer[]>([]);\n  const receivedBytesRef = useRef(0);\n  const [completedFile, setCompletedFile] = useState<{ blob: Blob, name: string, type: string } | null>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const folderInputRef = useRef<HTMLInputElement>(null);\n  const chatEndRef = useRef<HTMLDivElement>(null);\n\n  // NEW: Connection Timer\n  const [connTime, setConnTime] = useState(0);\n  const connTimerRef = useRef<ReturnType<typeof setInterval> | null>(null);\n\n  // NEW: File Preview\n  const [previewUrl, setPreviewUrl] = useState<string | null>(null);\n\n  // NEW: QR Code visibility\n  const [showQR, setShowQR] = useState(false);\n\n  // NEW: Self-destruct timer\n  const [selfDestructSec, setSelfDestructSec] = useState(0);\n  const selfDestructRef = useRef<ReturnType<typeof setInterval> | null>(null);\n\n  // i18n\n  const [lang, setLang] = useState<'en' | 'tr'>(() => (localStorage.getItem('ms-lang') as any) || (navigator.language.startsWith('tr') ? 'tr' : 'en'));\n  const t = (key: string) => i18n[lang]?.[key] || i18n['en'][key] || key;\n\n  // Tier 3: Video Preview\n  const [videoPreviewUrl, setVideoPreviewUrl] = useState<string | null>(null);\n  const [showVideoPlayer, setShowVideoPlayer] = useState(false);\n\n  // Tier 3: LAN Discovery\n  const [nearbyDevices, setNearbyDevices] = useState<{ id: string, name: string, time: number, code?: string }[]>([]);\n  const [showNearby, setShowNearby] = useState(false);\n  const bcRef = useRef<BroadcastChannel | null>(null);\n\n  // Tier 3: Swarm Mode (WebTorrent-inspired P2P mesh)\n  const [isSeeding, setIsSeeding] = useState(false);\n  const [swarmPeerCount, setSwarmPeerCount] = useState(0);\n  const seederPeerRef = useRef<Peer | null>(null);\n  const seederFileRef = useRef<Blob | null>(null);\n  const seederMetaRef = useRef<{ name: string, size: number, type: string } | null>(null);\n\n  // Initialize Share Code for Sender ÔÇö always generate fresh code\n  useEffect(() => {\n    if (mode === 'send') {\n      const newCode = generateCode();\n      setShareCode(newCode);\n    }\n  }, [mode]);\n\n  // Auto-join room from URL param (?room=abc-xyz%231234)\n  useEffect(() => {\n    const params = new URLSearchParams(window.location.search);\n    const roomCode = params.get('room');\n    if (roomCode) {\n      // Clean URL without reload\n      window.history.replaceState({}, '', window.location.pathname);\n      setReceiveCode(roomCode);\n      setMode('receive');\n      // Auto-connect after a short delay\n      setTimeout(() => {\n        resetConnection();\n        setErrorStatus(null);\n        setTransferProgress(0);\n\n        const parts = roomCode.trim().toLowerCase().split('#');\n        const cleanCode = parts[0].replace('-', '');\n        const targetId = `mephisto-${cleanCode}`;\n\n        const peer = new Peer({ debug: 2 });\n        peer.on('open', () => {\n          const conn = peer.connect(targetId, { reliable: true });\n          connRef.current = conn;\n          conn.on('open', () => {\n            setIsConnected(true);\n            const handshakeInterval = setInterval(() => {\n              if (fileMetaRef.current || !conn.open) { clearInterval(handshakeInterval); return; }\n              conn.send({ type: 'request-metadata' });\n            }, 500);\n          });\n          conn.on('data', (data: any) => {\n            try {\n              if (data.type === 'metadata' && !fileMetaRef.current) {\n                const meta = { name: data.name, size: data.size, type: data.mime };\n                setFileMeta(meta); fileMetaRef.current = meta;\n                receivedChunksRef.current = []; receivedBytesRef.current = 0;\n                setTransferProgress(0);\n                conn.send({ type: 'request-chunk', offset: 0 });\n              } else if (data.type === 'chunk') {\n                const buffer = data.buffer;\n                if (!buffer) throw new Error('Empty buffer');\n                const scrambled = new Uint8Array(buffer);\n                const pinStr = roomCode.split('#')[1] || '0';\n                const pin = parseInt(pinStr) || 1024;\n                for (let i = 0; i < scrambled.length; i++) { scrambled[i] ^= (pin % 256); }\n                receivedChunksRef.current.push(scrambled.buffer);\n                receivedBytesRef.current += scrambled.buffer.byteLength;\n                const m = fileMetaRef.current;\n                if (m) {\n                  setTransferProgress(Math.round((receivedBytesRef.current / m.size) * 100));\n                  if (receivedBytesRef.current < m.size) conn.send({ type: 'request-chunk', offset: receivedBytesRef.current });\n                  else finalizeDownload(m.name, m.type);\n                }\n              } else if (data.type === 'chat') {\n                setChatMessages(prev => [...prev, { id: Date.now(), text: data.text, sender: 'peer' }]);\n              }\n            } catch (err: any) { setErrorStatus('Data error: ' + err.message); }\n          });\n          conn.on('close', () => { setIsConnected(false); });\n          conn.on('error', (err) => { setErrorStatus(err.message); });\n        });\n        peer.on('error', () => { setErrorStatus(t('errorPeer')); setTransferProgress(-1); });\n        peerRef.current = peer;\n      }, 300);\n    }\n  }, []);  // only on mount\n\n  // Clean up Peer on unmount or mode change\n  useEffect(() => {\n    return () => {\n      resetConnection();\n      setFileToShare(null);\n      fileToShareRef.current = null;\n    };\n  }, [mode]);\n\n  // Auto-scroll chat to bottom on new messages\n  useEffect(() => {\n    chatEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [chatMessages]);\n\n  // Theme persistence\n  useEffect(() => {\n    localStorage.setItem('ms-theme', theme);\n    document.documentElement.classList.toggle('light-theme', theme === 'light');\n  }, [theme]);\n\n  // Language persistence\n  useEffect(() => {\n    localStorage.setItem('ms-lang', lang);\n  }, [lang]);\n\n  // Self-destruct countdown after transfer completes\n  useEffect(() => {\n    if (transferProgress >= 100 && isConnected) {\n      setSelfDestructSec(SELF_DESTRUCT_SEC);\n      selfDestructRef.current = setInterval(() => {\n        setSelfDestructSec(prev => {\n          if (prev <= 1) {\n            resetConnection();\n            setMode('idle');\n            return 0;\n          }\n          return prev - 1;\n        });\n      }, 1000);\n    }\n    return () => { if (selfDestructRef.current) clearInterval(selfDestructRef.current); };\n  }, [transferProgress >= 100]);\n\n  // Connection timer\n  useEffect(() => {\n    if (isConnected) {\n      setConnTime(0);\n      connTimerRef.current = setInterval(() => setConnTime(t => t + 1), 1000);\n    } else {\n      if (connTimerRef.current) clearInterval(connTimerRef.current);\n      connTimerRef.current = null;\n    }\n    return () => { if (connTimerRef.current) clearInterval(connTimerRef.current); };\n  }, [isConnected]);\n\n  // File preview URL\n  useEffect(() => {\n    if (fileToShare && fileToShare.type.startsWith('image/')) {\n      const url = URL.createObjectURL(fileToShare);\n      setPreviewUrl(url);\n      return () => URL.revokeObjectURL(url);\n    } else {\n      setPreviewUrl(null);\n    }\n  }, [fileToShare]);\n\n  // Video preview URL for completed file\n  useEffect(() => {\n    if (completedFile && completedFile.type.startsWith('video/')) {\n      const url = URL.createObjectURL(completedFile.blob);\n      setVideoPreviewUrl(url);\n      return () => URL.revokeObjectURL(url);\n    } else {\n      setVideoPreviewUrl(null);\n      setShowVideoPlayer(false);\n    }\n  }, [completedFile]);\n\n  // LAN Discovery via BroadcastChannel ÔÇö include shareCode so others can auto-connect\n  const deviceId = useRef(Math.random().toString(36).substring(2, 8));\n  useEffect(() => {\n    const bc = new BroadcastChannel('mephisto-share-discovery');\n    bcRef.current = bc;\n\n    const announce = () => {\n      bc.postMessage({\n        type: 'announce',\n        id: deviceId.current,\n        name: `Device-${deviceId.current}`,\n        time: Date.now(),\n        code: shareCode || undefined,  // share the room code if sender\n        mode: mode,\n      });\n    };\n\n    bc.onmessage = (e) => {\n      const data = e.data;\n      if (data.type === 'announce' && data.id !== deviceId.current) {\n        setNearbyDevices(prev => {\n          const exists = prev.find(d => d.id === data.id);\n          if (exists) return prev.map(d => d.id === data.id ? { ...d, time: data.time, code: data.code || d.code } : d);\n          return [...prev, { id: data.id, name: data.name, time: data.time, code: data.code }];\n        });\n      }\n    };\n\n    announce();\n    const interval = setInterval(announce, 3000);\n    const cleanup = setInterval(() => {\n      setNearbyDevices(prev => prev.filter(d => Date.now() - d.time < 10000));\n    }, 10000);\n\n    return () => {\n      clearInterval(interval);\n      clearInterval(cleanup);\n      bc.close();\n    };\n  }, [shareCode, mode]);\n\n  const formatTime = (s: number) => `${String(Math.floor(s / 60)).padStart(2, '0')}:${String(s % 60).padStart(2, '0')}`;\n\n  const playSound = useCallback(() => {\n    try {\n      const ctx = new AudioContext();\n      const osc = ctx.createOscillator();\n      const gain = ctx.createGain();\n      osc.connect(gain); gain.connect(ctx.destination);\n      osc.frequency.value = 880; osc.type = 'sine';\n      gain.gain.setValueAtTime(0.3, ctx.currentTime);\n      gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);\n      osc.start(ctx.currentTime); osc.stop(ctx.currentTime + 0.5);\n      setTimeout(() => {\n        const o2 = ctx.createOscillator(); const g2 = ctx.createGain();\n        o2.connect(g2); g2.connect(ctx.destination);\n        o2.frequency.value = 1320; o2.type = 'sine';\n        g2.gain.setValueAtTime(0.3, ctx.currentTime);\n        g2.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.6);\n        o2.start(ctx.currentTime); o2.stop(ctx.currentTime + 0.6);\n      }, 200);\n    } catch (e) { /* silent fallback */ }\n  }, []);\n\n  const EMOJIS = ['­şæı', 'ÔØñ´©Å', '­şİé', '­şöÑ', '­şæÅ', '­şİ«', '­şÄë', '­şÆ»'];\n\n  const resetConnection = () => {\n    if (connRef.current) {\n      connRef.current.close();\n      connRef.current = null;\n    }\n    if (peerRef.current) {\n      peerRef.current.destroy();\n      peerRef.current = null;\n    }\n    setIsConnected(false);\n    setTransferProgress(-1);\n    setFileMeta(null);\n    fileMetaRef.current = null;\n    receivedChunksRef.current = [];\n    receivedBytesRef.current = 0;\n    setCompletedFile(null);\n    setChatMessages([]);\n    setErrorStatus(null);\n    setConnTime(0);\n    setSelfDestructSec(0);\n    setPeerCount(0);\n    setShareCode('');\n    multiConnsRef.current.forEach(c => { try { c.close(); } catch { } });\n    multiConnsRef.current = [];\n    if (selfDestructRef.current) { clearInterval(selfDestructRef.current); selfDestructRef.current = null; }\n    // Clean seeder\n    if (seederPeerRef.current) { try { seederPeerRef.current.destroy(); } catch { } seederPeerRef.current = null; }\n    setIsSeeding(false); setSwarmPeerCount(0);\n  };\n\n  const handleCopy = () => {\n    navigator.clipboard.writeText(shareCode);\n    setCopied(true);\n    setTimeout(() => setCopied(false), 2000);\n  };\n\n  // ---------------------------------------------------------------------------\n  // SENDER ALGORITHM\n  // ---------------------------------------------------------------------------\n  const initSender = () => {\n    if (!shareCode) return;\n\n    resetConnection();\n    setErrorStatus(null);\n\n    const cleanCode = shareCode.split('#')[0].replace(/-/g, '').toLowerCase();\n    const peer = new Peer(`mephisto-${cleanCode}`, {\n      debug: 2\n    });\n\n    peer.on('open', (id) => {\n      console.log('Sender is ready. Listening on ID:', id);\n    });\n\n    peer.on('connection', (conn) => {\n      connRef.current = conn;\n      multiConnsRef.current.push(conn);\n      setPeerCount(prev => prev + 1);\n\n      conn.on('open', () => {\n        setIsConnected(true);\n      });\n\n      conn.on('data', (data: any) => {\n        console.log('Sender received data:', data.type);\n        if (data.type === 'request-metadata') {\n          if (fileToShareRef.current) {\n            console.log('Sender replying with metadata...');\n            conn.send({\n              type: 'metadata',\n              name: fileToShareRef.current.name,\n              size: fileToShareRef.current.size,\n              mime: fileToShareRef.current.type\n            });\n          }\n        }\n        else if (data.type === 'request-chunk') {\n          sendChunk(data.offset, conn);\n        }\n        else if (data.type === 'chat') {\n          setChatMessages(prev => [...prev, { id: Date.now(), text: data.text, sender: 'peer' }]);\n        }\n      });\n\n      conn.on('close', () => {\n        multiConnsRef.current = multiConnsRef.current.filter(c => c !== conn);\n        setPeerCount(multiConnsRef.current.length);\n        if (multiConnsRef.current.length === 0) {\n          setIsConnected(false);\n          setErrorStatus('Connection lost.');\n        }\n      });\n\n      conn.on('error', (err) => {\n        console.error('Conn Error:', err);\n        setErrorStatus(err.message);\n      });\n    });\n\n    peerRef.current = peer;\n  };\n\n  const sendChunk = async (offset: number, targetConn?: DataConnection) => {\n    try {\n      const file = fileToShareRef.current;\n      const conn = targetConn || connRef.current;\n      if (!file || !conn) return;\n\n      const end = Math.min(offset + CHUNK_SIZE, file.size);\n      const slice = file.slice(offset, end);\n\n      const buffer = await slice.arrayBuffer();\n\n      // Double Encryption (XOR Stream Scramble)\n      const scrambled = new Uint8Array(buffer);\n      const pinStr = shareCode.split('#')[1] || \"0\";\n      const pin = parseInt(pinStr) || 1024;\n      for (let i = 0; i < scrambled.length; i++) {\n        scrambled[i] ^= (pin % 256);\n      }\n\n      conn.send({\n        type: 'chunk',\n        buffer: scrambled.buffer,\n        offset: offset\n      });\n\n      const progress = Math.round((end / file.size) * 100);\n      setTransferProgress(progress);\n    } catch (err: any) {\n      console.error('sendChunk Error:', err);\n      setErrorStatus('Failed to send file chunk: ' + err.message);\n    }\n  };\n\n  useEffect(() => {\n    if (mode === 'send' && shareCode && !peerRef.current) {\n      initSender();\n    }\n  }, [mode, shareCode]);\n\n\n  // ---------------------------------------------------------------------------\n  // RECEIVER ALGORITHM\n  // ---------------------------------------------------------------------------\n  const handleConnectReceiver = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!receiveCode) return;\n\n    resetConnection();\n    setErrorStatus(null);\n    setTransferProgress(0); // Show connection loader\n\n    const parts = receiveCode.trim().toLowerCase().split('#');\n    const cleanCode = parts[0].replace('-', '');\n    const targetId = `mephisto-${cleanCode}`;\n\n    const peer = new Peer({ debug: 2 });\n\n    peer.on('open', () => {\n      // Attempt connection to sender\n      const conn = peer.connect(targetId, {\n        reliable: true\n      });\n      connRef.current = conn;\n\n      conn.on('open', () => {\n        setIsConnected(true);\n        console.log('Receiver data channel open. Starting robust handshake...');\n\n        // Robust handshake: keep asking every 500ms until sender responds\n        const handshakeInterval = setInterval(() => {\n          if (fileMetaRef.current || !conn.open) {\n            clearInterval(handshakeInterval);\n            return;\n          }\n          console.log('Receiver requesting metadata...');\n          conn.send({ type: 'request-metadata' });\n        }, 500);\n      });\n\n      conn.on('data', (data: any) => {\n        try {\n          if (data.type === 'metadata') {\n            console.log('Receiver got metadata:', data);\n            // Allow multiple metadata packets safely but only initialize once if needed\n            if (!fileMetaRef.current) {\n              const meta = {\n                name: data.name,\n                size: data.size,\n                type: data.mime\n              };\n              setFileMeta(meta);\n              fileMetaRef.current = meta;\n              receivedChunksRef.current = [];\n              receivedBytesRef.current = 0;\n              setTransferProgress(0);\n\n              // Request first chunk\n              console.log('Receiver requesting first chunk...');\n              conn.send({ type: 'request-chunk', offset: 0 });\n            }\n          }\n          else if (data.type === 'chunk') {\n            const buffer = data.buffer;\n            if (!buffer) throw new Error(\"Empty buffer received.\");\n            console.log(`Receiver received chunk: offset ${data.offset}, size ${buffer.byteLength}`);\n\n            // Double Encryption Unscramble\n            const scrambled = new Uint8Array(buffer);\n            const pinStr = receiveCode.split('#')[1] || \"0\";\n            const pin = parseInt(pinStr) || 1024;\n            for (let i = 0; i < scrambled.length; i++) {\n              scrambled[i] ^= (pin % 256);\n            }\n\n            // Handle different ArrayBuffer implementations/shapes passing through WebRTC\n            const byteLength = scrambled.buffer.byteLength !== undefined ? scrambled.buffer.byteLength : (scrambled.buffer as any).length !== undefined ? (scrambled.buffer as any).length : 0;\n            if (byteLength === 0) throw new Error(\"Received chunk has zero length.\");\n\n            receivedChunksRef.current.push(scrambled.buffer);\n            receivedBytesRef.current += byteLength;\n\n            const meta = fileMetaRef.current;\n            if (meta) {\n              const progress = Math.round((receivedBytesRef.current / meta.size) * 100);\n              setTransferProgress(progress);\n\n              if (receivedBytesRef.current < meta.size) {\n                // Request next chunk\n                conn.send({ type: 'request-chunk', offset: receivedBytesRef.current });\n              } else {\n                // Transfer complete\n                finalizeDownload(meta.name, meta.type);\n              }\n            }\n          }\n          else if (data.type === 'chat') {\n            setChatMessages(prev => [...prev, { id: Date.now(), text: data.text, sender: 'peer' }]);\n          }\n        } catch (err: any) {\n          console.error('Receive Data Error:', err);\n          setErrorStatus('Data parsing error: ' + err.message);\n        }\n      });\n\n      conn.on('close', () => {\n        if (transferProgress < 100 && transferProgress > 0) {\n          setErrorStatus('Connection closed unexpectedly.');\n        }\n        setIsConnected(false);\n      });\n\n      conn.on('error', (err) => {\n        setErrorStatus('Connection error: ' + err.message);\n      });\n    });\n\n    peer.on('error', (err) => {\n      console.error('Peer Error:', err);\n      setErrorStatus('Error: Could not find or connect to that peer. Check the code.');\n      setTransferProgress(-1);\n    });\n\n    peerRef.current = peer;\n  };\n\n  const finalizeDownload = async (name: string, type: string) => {\n    const blob = new Blob(receivedChunksRef.current, { type: type || 'application/octet-stream' });\n    setCompletedFile({ blob, name, type });\n    setTransferProgress(100);\n    playSound();\n  };\n\n  // ---------------------------------------------------------------------------\n  // UI HANDLERS & BUNDLING\n  // ---------------------------------------------------------------------------\n  const processFiles = async (files: any[]) => {\n    if (files.length === 0) return;\n\n    // Check if we need to zip: >1 file OR it has a custom path/folder structure\n    const needsZip = files.length > 1 || files.some(f => f.customPath?.includes('/') || (f.webkitRelativePath && f.webkitRelativePath.includes('/')));\n\n    if (!needsZip) {\n      const file = files[0];\n      setFileToShare(file);\n      fileToShareRef.current = file;\n    } else {\n      setIsZipping(true);\n      const zip = new JSZip();\n\n      files.forEach(f => {\n        const path = f.customPath || (f.webkitRelativePath && f.webkitRelativePath.includes('/') ? f.webkitRelativePath : f.name);\n        zip.file(path, f);\n      });\n\n      const content = await zip.generateAsync({\n        type: 'blob',\n        compression: 'DEFLATE',\n        compressionOptions: { level: 5 }\n      }, (meta) => {\n        setZipProgress(meta.percent);\n      });\n\n      const bundledFile = new File([content], `mephisto-bundle-${Math.floor(Date.now() / 1000)}.zip`, { type: 'application/zip' });\n      setIsZipping(false);\n      setFileToShare(bundledFile);\n      fileToShareRef.current = bundledFile;\n    }\n  };\n\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (e.target.files) processFiles(Array.from(e.target.files));\n  };\n\n  const handleDragOver = (e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragging(true);\n  };\n\n  const handleDragLeave = (e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragging(false);\n  };\n\n  const scanEntry = async (entry: any, path: string = ''): Promise<any[]> => {\n    if (entry.isFile) {\n      return new Promise<any[]>((resolve) => {\n        entry.file((file: File) => {\n          (file as any).customPath = path + file.name;\n          resolve([file]);\n        });\n      });\n    } else if (entry.isDirectory) {\n      const dirReader = entry.createReader();\n      return new Promise<any[]>((resolve) => {\n        const readAll = async () => {\n          let allFiles: any[] = [];\n          const readEntries = () => new Promise<any[]>((res) => dirReader.readEntries(res));\n\n          let entries = await readEntries();\n          while (entries.length > 0) {\n            for (const cEntry of entries) {\n              const files = await scanEntry(cEntry, path + entry.name + '/');\n              allFiles = allFiles.concat(files);\n            }\n            entries = await readEntries();\n          }\n          resolve(allFiles);\n        };\n        readAll();\n      });\n    }\n    return [];\n  };\n\n  const handleDrop = async (e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragging(false);\n\n    if (e.dataTransfer.items) {\n      const items = Array.from(e.dataTransfer.items);\n      let allFiles: any[] = [];\n      for (const item of items) {\n        if (item.kind === 'file') {\n          const entry = item.webkitGetAsEntry ? item.webkitGetAsEntry() : (item as any).getAsEntry ? (item as any).getAsEntry() : null;\n          if (entry) {\n            const files = await scanEntry(entry);\n            allFiles = allFiles.concat(files);\n          } else {\n            const file = item.getAsFile();\n            if (file) allFiles.push(file);\n          }\n        }\n      }\n      processFiles(allFiles);\n    } else if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {\n      processFiles(Array.from(e.dataTransfer.files));\n    }\n  };\n\n  // Auto-connect to a nearby device's room\n  const connectToDevice = (code: string) => {\n    setMode('receive');\n    setReceiveCode(code);\n    // Simulate form submit after a tick\n    setTimeout(() => {\n      // Trigger connection manually\n      resetConnection();\n      setErrorStatus(null);\n      setTransferProgress(0);\n\n      const parts = code.trim().toLowerCase().split('#');\n      const cleanCode = parts[0].replace('-', '');\n      const targetId = `mephisto-${cleanCode}`;\n\n      const peer = new Peer({ debug: 2 });\n\n      peer.on('open', () => {\n        const conn = peer.connect(targetId, { reliable: true });\n        connRef.current = conn;\n\n        conn.on('open', () => {\n          setIsConnected(true);\n          const handshakeInterval = setInterval(() => {\n            if (fileMetaRef.current || !conn.open) { clearInterval(handshakeInterval); return; }\n            conn.send({ type: 'request-metadata' });\n          }, 500);\n        });\n\n        conn.on('data', (data: any) => {\n          try {\n            if (data.type === 'metadata' && !fileMetaRef.current) {\n              const meta = { name: data.name, size: data.size, type: data.mime };\n              setFileMeta(meta);\n              fileMetaRef.current = meta;\n              receivedChunksRef.current = [];\n              receivedBytesRef.current = 0;\n              setTransferProgress(0);\n              conn.send({ type: 'request-chunk', offset: 0 });\n            } else if (data.type === 'chunk') {\n              const buffer = data.buffer;\n              if (!buffer) throw new Error(\"Empty buffer received.\");\n              const scrambled = new Uint8Array(buffer);\n              const pinStr = code.split('#')[1] || \"0\";\n              const pin = parseInt(pinStr) || 1024;\n              for (let i = 0; i < scrambled.length; i++) { scrambled[i] ^= (pin % 256); }\n              const byteLength = scrambled.buffer.byteLength !== undefined ? scrambled.buffer.byteLength : 0;\n              receivedChunksRef.current.push(scrambled.buffer);\n              receivedBytesRef.current += byteLength;\n              const meta = fileMetaRef.current;\n              if (meta) {\n                setTransferProgress(Math.round((receivedBytesRef.current / meta.size) * 100));\n                if (receivedBytesRef.current < meta.size) {\n                  conn.send({ type: 'request-chunk', offset: receivedBytesRef.current });\n                } else {\n                  finalizeDownload(meta.name, meta.type);\n                }\n              }\n            } else if (data.type === 'chat') {\n              setChatMessages(prev => [...prev, { id: Date.now(), text: data.text, sender: 'peer' }]);\n            }\n          } catch (err: any) { setErrorStatus('Data parsing error: ' + err.message); }\n        });\n\n        conn.on('close', () => { setIsConnected(false); });\n        conn.on('error', (err) => { setErrorStatus('Connection error: ' + err.message); });\n      });\n\n      peer.on('error', () => {\n        setErrorStatus(t('errorPeer'));\n        setTransferProgress(-1);\n      });\n\n      peerRef.current = peer;\n    }, 100);\n  };\n\n  const broadcastToAll = (msg: any) => {\n    if (mode === 'send') {\n      multiConnsRef.current.forEach(c => { try { if (c.open) c.send(msg); } catch { } });\n    } else if (connRef.current?.open) {\n      connRef.current.send(msg);\n    }\n  };\n\n  // Swarm Mode: become a seeder after downloading\n  const becomeSeeder = () => {\n    if (!completedFile || isSeeding) return;\n\n    // Generate clean ID without # (PeerJS doesn't allow #)\n    const chars = 'abcdefghjkmnpqrstuvwxyz23456789';\n    let seedId = '';\n    for (let i = 0; i < 8; i++) seedId += chars.charAt(Math.floor(Math.random() * chars.length));\n    const seedCode = `swarm-${seedId}`;\n    seederFileRef.current = completedFile.blob;\n    seederMetaRef.current = { name: completedFile.name, size: completedFile.blob.size, type: completedFile.type };\n\n    const peer = new Peer(`mephisto-${seedCode}`, { debug: 1 });\n    seederPeerRef.current = peer;\n\n    peer.on('open', () => {\n      setIsSeeding(true);\n    });\n\n    peer.on('connection', (conn) => {\n      setSwarmPeerCount(prev => prev + 1);\n\n      conn.on('open', () => {\n        // nothing special\n      });\n\n      conn.on('data', (data: any) => {\n        if (data.type === 'request-metadata' && seederMetaRef.current) {\n          conn.send({ type: 'metadata', name: seederMetaRef.current.name, size: seederMetaRef.current.size, mime: seederMetaRef.current.type });\n        } else if (data.type === 'request-chunk' && seederFileRef.current) {\n          const file = seederFileRef.current;\n          const offset = data.offset;\n          const end = Math.min(offset + CHUNK_SIZE, file.size);\n          const reader = new FileReader();\n          reader.onload = () => {\n            if (reader.result && conn.open) {\n              const buffer = reader.result as ArrayBuffer;\n              const scrambled = new Uint8Array(buffer);\n              // No encryption for swarm relay\n              conn.send({ type: 'chunk', buffer: scrambled.buffer, offset });\n            }\n          };\n          reader.readAsArrayBuffer(file.slice(offset, end));\n        }\n      });\n\n      conn.on('close', () => {\n        setSwarmPeerCount(prev => Math.max(0, prev - 1));\n      });\n    });\n  };\n\n  const sendChatMessage = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!chatInput.trim()) return;\n    const msg = chatInput.trim();\n    broadcastToAll({ type: 'chat', text: msg });\n    setChatMessages(prev => [...prev, { id: Date.now(), text: msg, sender: 'me' }]);\n    setChatInput('');\n    setShowEmojiPicker(false);\n  };\n\n  const sendEmoji = (emoji: string) => {\n    broadcastToAll({ type: 'chat', text: emoji });\n    setChatMessages(prev => [...prev, { id: Date.now(), text: emoji, sender: 'me' }]);\n    setShowEmojiPicker(false);\n  };\n\n  const sendClipboard = async () => {\n    try {\n      const text = await navigator.clipboard.readText();\n      if (text) {\n        broadcastToAll({ type: 'chat', text: `­şôï ${text}` });\n        setChatMessages(prev => [...prev, { id: Date.now(), text: `­şôï ${text}`, sender: 'me' }]);\n      }\n    } catch { /* clipboard access denied */ }\n  };\n\n\n  return (\n    <div className={`min-h-screen flex flex-col items-center justify-center p-4 selection:bg-orange-500/30 transition-colors duration-300 ${theme === 'light' ? 'bg-slate-100 text-slate-900' : ''}`}>\n\n      {/* Theme & Language Toggle */}\n      <div className=\"fixed top-4 right-4 z-50 flex gap-2\">\n        <button onClick={() => setLang(l => l === 'en' ? 'tr' : 'en')} className=\"p-2 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 transition-colors\" title=\"Language\">\n          <Globe className=\"w-5 h-5 text-blue-400\" />\n        </button>\n        <button onClick={() => setTheme(t => t === 'dark' ? 'light' : 'dark')} className=\"p-2 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 transition-colors\" title=\"Toggle Theme\">\n          {theme === 'dark' ? <Sun className=\"w-5 h-5 text-yellow-400\" /> : <Moon className=\"w-5 h-5 text-slate-600\" />}\n        </button>\n      </div>\n\n      {/* Background Decor */}\n      <div className=\"fixed inset-0 pointer-events-none overflow-hidden z-0\">\n        <div className=\"absolute top-[20%] left-[50%] -translate-x-1/2 w-[60vw] h-[60vw] max-w-[800px] max-h-[800px] bg-orange-500/[0.03] rounded-full blur-3xl mix-blend-screen\" />\n        <div className=\"absolute bottom-[10%] left-[20%] w-[40vw] h-[40vw] max-w-[600px] max-h-[600px] bg-blue-500/[0.03] rounded-full blur-3xl mix-blend-screen\" />\n      </div>\n\n      <div className=\"z-10 w-full max-w-lg\">\n        {/* Header */}\n        <div className=\"flex flex-col items-center justify-center mb-12 text-center\">\n          <div className=\"w-16 h-16 bg-white/[0.03] border border-white/10 rounded-2xl flex items-center justify-center mb-6 shadow-2xl relative overflow-hidden group\">\n            <div className=\"absolute inset-0 bg-gradient-to-tr from-orange-500/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity\" />\n            <Activity className=\"w-8 h-8 text-orange-500\" />\n            {isConnected ? (\n              <div className=\"absolute inset-0 border-2 border-orange-500/50 rounded-2xl animate-pulse\" />\n            ) : (\n              <div className=\"radar-sweep opacity-50\" />\n            )}\n          </div>\n          <h1 className=\"text-4xl font-black tracking-tight mb-3\">\n            Mephisto<span className=\"text-transparent bg-clip-text bg-gradient-to-r from-orange-500 to-red-500\">Share</span>\n          </h1>\n          <p className=\"text-base text-slate-400 font-medium\">\n            {t('subtitle')}\n            <br /> <span className=\"text-slate-500\">{t('subtitle2')}</span>\n          </p>\n          {isConnected && (\n            <motion.div initial={{ opacity: 0, scale: 0.8 }} animate={{ opacity: 1, scale: 1 }} className=\"mt-4 flex items-center gap-2 bg-green-500/10 border border-green-500/20 text-green-400 text-xs font-mono px-3 py-1.5 rounded-full\">\n              <Clock className=\"w-3 h-3\" /> {t('connected')}: {formatTime(connTime)}\n            </motion.div>\n          )}\n        </div>\n\n        {/* Main Panel */}\n        <AnimatePresence mode=\"wait\">\n          {mode === 'idle' && (\n            <motion.div\n              key=\"idle\"\n              initial={{ opacity: 0, y: 10 }}\n              animate={{ opacity: 1, y: 0 }}\n              exit={{ opacity: 0, scale: 0.95 }}\n              className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\"\n            >\n              <button\n                onClick={() => setMode('send')}\n                className=\"glass-panel p-8 flex flex-col items-center justify-center hover:bg-white/[0.04] hover:border-orange-500/30 transition-all group cursor-pointer\"\n              >\n                <div className=\"w-12 h-12 rounded-full bg-orange-500/10 flex items-center justify-center mb-4 group-hover:scale-110 transition-transform\">\n                  <Upload className=\"w-6 h-6 text-orange-500\" />\n                </div>\n                <span className=\"text-lg font-bold text-white mb-1\">Send Files</span>\n                <span className=\"text-sm text-slate-400 text-center\">Generate link & send</span>\n              </button>\n\n              <button\n                onClick={() => setMode('receive')}\n                className=\"glass-panel p-8 flex flex-col items-center justify-center hover:bg-white/[0.04] hover:border-blue-500/30 transition-all group cursor-pointer\"\n              >\n                <div className=\"w-12 h-12 rounded-full bg-blue-500/10 flex items-center justify-center mb-4 group-hover:scale-110 transition-transform\">\n                  <Download className=\"w-6 h-6 text-blue-500\" />\n                </div>\n                <span className=\"text-lg font-bold text-white mb-1\">{t('receiveFiles')}</span>\n                <span className=\"text-sm text-slate-400 text-center\">{t('receiveDesc')}</span>\n              </button>\n            </motion.div>\n          )}\n\n          {/* SEND MODE */}\n          {mode === 'send' && (\n            <motion.div\n              key=\"send\"\n              initial={{ opacity: 0, scale: 0.95 }}\n              animate={{ opacity: 1, scale: 1 }}\n              exit={{ opacity: 0, y: 10 }}\n              className=\"glass-panel overflow-hidden\"\n            >\n              <div className=\"p-4 border-b border-white/5 flex items-center justify-between\">\n                <h2 className=\"text-white font-bold flex items-center gap-2\">\n                  <Upload className=\"w-4 h-4 text-orange-500\" /> {t('sendTitle')}\n                </h2>\n                <button onClick={() => setMode('idle')} className=\"text-slate-400 hover:text-white p-1 rounded-md hover:bg-white/10 transition-colors\">\n                  <X className=\"w-4 h-4\" />\n                </button>\n              </div>\n\n              <div className=\"p-6 md:p-8\">\n                {!fileToShare ? (\n                  isZipping ? (\n                    <div className=\"flex flex-col items-center justify-center p-12 text-center bg-black/40 border-2 border-dashed border-orange-500/50 rounded-2xl\">\n                      <div className=\"relative w-20 h-20 mb-6\">\n                        <div className=\"absolute inset-0 border-4 border-orange-500/30 rounded-full animate-spin\"></div>\n                        <div className=\"absolute inset-0 flex items-center justify-center font-bold text-orange-500\">{Math.round(zipProgress)}%</div>\n                      </div>\n                      <h3 className=\"text-xl font-bold text-white mb-2\">{t('compressing')}</h3>\n                      <p className=\"text-sm text-slate-400\">{t('compressSub')}</p>\n                    </div>\n                  ) : (\n                    <div className=\"flex flex-col gap-4 w-full\">\n                      <div\n                        onClick={() => fileInputRef.current?.click()}\n                        onDragOver={handleDragOver}\n                        onDragLeave={handleDragLeave}\n                        onDrop={handleDrop}\n                        className={`relative w-full border-2 border-dashed rounded-2xl p-8 transition-all cursor-pointer group flex flex-col items-center text-center overflow-hidden\n                           ${isDragging ? 'border-orange-500 bg-orange-500/10 scale-105 shadow-[0_0_30px_rgba(249,115,22,0.2)]' : 'border-white/10 hover:border-orange-500/30 hover:bg-orange-500/5'}`}\n                      >\n                        <input ref={fileInputRef} type=\"file\" multiple className=\"hidden\" onChange={handleFileChange} />\n                        <motion.div animate={{ y: isDragging ? -10 : 0 }} className={`w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 transition-colors ${isDragging ? 'bg-orange-500/40' : 'bg-white/5 group-hover:bg-orange-500/20'}`}>\n                          <Upload className={`w-8 h-8 transition-colors ${isDragging ? 'text-white' : 'text-slate-400 group-hover:text-orange-500'}`} />\n                        </motion.div>\n                        <p className=\"text-white font-bold text-lg mb-1\">{isDragging ? t('dropHot') : t('dropHere')}</p>\n                        <p className=\"text-slate-500 text-sm\">{t('dropSubFolder')}</p>\n                      </div>\n\n                      {/* Explicit Folder Selection Button */}\n                      <button\n                        onClick={() => folderInputRef.current?.click()}\n                        className=\"w-full bg-white/5 hover:bg-white/10 border border-white/10 text-slate-300 hover:text-white py-3 rounded-xl transition-colors font-semibold flex items-center justify-center gap-2\"\n                      >\n                        <Folder className=\"w-5 h-5 text-orange-400\" /> {t('selectFolder')}\n                      </button>\n                      <input\n                        ref={folderInputRef}\n                        type=\"file\"\n                        {...{ webkitdirectory: \"\", directory: \"\" } as any}\n                        multiple\n                        className=\"hidden\"\n                        onChange={handleFileChange}\n                      />\n                    </div>\n                  )\n                ) : (\n                  // Step 2: Show Code & Status\n                  <div className=\"flex flex-col items-center\">\n                    {/* File Info */}\n                    <div className=\"w-full flex items-center gap-4 bg-black/40 border border-white/5 rounded-xl p-4 mb-6\">\n                      <div className=\"w-10 h-10 rounded-lg bg-orange-500/10 flex items-center justify-center shrink-0\">\n                        <FileIcon className=\"w-5 h-5 text-orange-500\" />\n                      </div>\n                      <div className=\"flex-1 min-w-0\">\n                        <p className=\"text-white font-bold text-sm truncate\">{fileToShare.name}</p>\n                        <p className=\"text-slate-400 text-xs\">{formatBytes(fileToShare.size)}</p>\n                      </div>\n                      {transferProgress <= 0 && !isConnected && (\n                        <button onClick={() => setFileToShare(null)} className=\"text-slate-500 hover:text-white p-2\">\n                          <X className=\"w-4 h-4\" />\n                        </button>\n                      )}\n                    </div>\n\n                    {errorStatus && (\n                      <div className=\"w-full bg-red-500/10 border border-red-500/20 text-red-400 text-sm p-3 rounded-lg mb-6 text-center\">\n                        {errorStatus}\n                      </div>\n                    )}\n\n                    {(!isConnected && !errorStatus) && (\n                      <div className=\"text-center mb-6\">\n                        <p className=\"text-sm text-slate-400 mb-4\">{t('shareCode')}</p>\n                        <div className=\"flex items-center gap-2 justify-center\">\n                          <div className=\"bg-black/60 border border-white/10 px-6 py-4 rounded-xl font-mono text-3xl font-black tracking-widest text-orange-500 shadow-inner\">\n                            {shareCode}\n                          </div>\n                          <div className=\"flex flex-col gap-2\">\n                            <button onClick={handleCopy} className=\"bg-white/5 hover:bg-white/10 border border-white/5 p-3 rounded-xl transition-colors group\" title=\"Copy Code\">\n                              {copied ? <Check className=\"w-5 h-5 text-green-500\" /> : <Copy className=\"w-5 h-5 text-slate-400 group-hover:text-white\" />}\n                            </button>\n                            <button onClick={() => setShowQR(!showQR)} className=\"bg-white/5 hover:bg-white/10 border border-white/5 p-3 rounded-xl transition-colors group\" title=\"Show QR Code\">\n                              <QrCode className=\"w-5 h-5 text-slate-400 group-hover:text-white\" />\n                            </button>\n                          </div>\n                        </div>\n                        {/* QR Code */}\n                        <AnimatePresence>\n                          {showQR && (\n                            <motion.div initial={{ opacity: 0, height: 0 }} animate={{ opacity: 1, height: 'auto' }} exit={{ opacity: 0, height: 0 }} className=\"mt-4 flex justify-center\">\n                              <div className=\"bg-white p-4 rounded-2xl shadow-lg\">\n                                <QRCodeSVG value={`${window.location.origin}${window.location.pathname}?room=${encodeURIComponent(shareCode)}`} size={180} bgColor=\"#fff\" fgColor=\"#0f172a\" level=\"H\" />\n                              </div>\n                            </motion.div>\n                          )}\n                        </AnimatePresence>\n                      </div>\n                    )}\n\n                    {/* File Preview */}\n                    {previewUrl && (\n                      <div className=\"w-full mb-4 rounded-xl overflow-hidden border border-white/10 max-h-40\">\n                        <img src={previewUrl} alt=\"Preview\" className=\"w-full h-full object-cover\" />\n                      </div>\n                    )}\n\n                    <div className=\"w-full flex flex-col items-center justify-center py-4\">\n                      {/* Multi-Peer Room Badge */}\n                      {peerCount > 0 && (\n                        <motion.div initial={{ opacity: 0, scale: 0.8 }} animate={{ opacity: 1, scale: 1 }} className=\"mb-4 flex items-center gap-2 bg-purple-500/10 border border-purple-500/20 text-purple-400 text-xs font-mono px-3 py-1.5 rounded-full\">\n                          <Users className=\"w-3 h-3\" /> {peerCount} {t('peers')}\n                        </motion.div>\n                      )}\n                      {isConnected ? (\n                        transferProgress >= 100 ? (\n                          <div className=\"text-center\">\n                            <div className=\"w-16 h-16 rounded-full bg-green-500/20 flex items-center justify-center mx-auto mb-3\">\n                              <Check className=\"w-8 h-8 text-green-500\" />\n                            </div>\n                            <p className=\"text-green-500 font-bold\">{t('complete')}</p>\n                            {selfDestructSec > 0 && (\n                              <div className=\"mt-2 flex items-center gap-2 text-red-400 text-xs font-mono animate-pulse\">\n                                <Bomb className=\"w-3 h-3\" /> {t('selfDestruct')} {selfDestructSec}s\n                              </div>\n                            )}\n                          </div>\n                        ) : (\n                          <div className=\"w-full\">\n                            <div className=\"flex justify-between text-sm mb-2 font-mono\">\n                              <span className=\"text-orange-500 font-bold animate-pulse\">{t('sending')} ­şöÉ</span>\n                              <span className=\"text-slate-300\"><AnimatedCounter value={transferProgress} /></span>\n                            </div>\n                            <div className=\"w-full h-3 bg-white/5 rounded-full overflow-hidden border border-white/5\">\n                              <div\n                                className=\"h-full bg-gradient-to-r from-orange-600 to-orange-400 rounded-full transition-all duration-300 ease-out\"\n                                style={{ width: `${transferProgress}%` }}\n                              />\n                            </div>\n                          </div>\n                        )\n                      ) : (\n                        <div className=\"flex items-center gap-2 text-orange-500/80 mt-2\">\n                          <Loader2 className=\"w-4 h-4 animate-spin\" />\n                          <span className=\"text-sm font-mono animate-pulse\">{t('waiting')}</span>\n                        </div>\n                      )}\n                    </div>\n\n                  </div>\n                )}\n              </div>\n            </motion.div>\n          )}\n\n          {/* RECEIVE MODE */}\n          {mode === 'receive' && (\n            <motion.div\n              key=\"receive\"\n              initial={{ opacity: 0, scale: 0.95 }}\n              animate={{ opacity: 1, scale: 1 }}\n              exit={{ opacity: 0, y: 10 }}\n              className=\"glass-panel overflow-hidden\"\n            >\n              <div className=\"p-4 border-b border-white/5 flex items-center justify-between\">\n                <h2 className=\"text-white font-bold flex items-center gap-2\">\n                  <Download className=\"w-4 h-4 text-blue-500\" /> {t('receiveTitle')}\n                </h2>\n                <button onClick={() => setMode('idle')} className=\"text-slate-400 hover:text-white p-1 rounded-md hover:bg-white/10 transition-colors\">\n                  <X className=\"w-4 h-4\" />\n                </button>\n              </div>\n              <div className=\"p-6 md:p-8\">\n\n                {errorStatus && (\n                  <div className=\"w-full bg-red-500/10 border border-red-500/20 text-red-400 text-sm p-3 rounded-lg mb-6 text-center\">\n                    {errorStatus}\n                  </div>\n                )}\n\n                {(!isConnected && transferProgress === -1) ? (\n                  <form onSubmit={handleConnectReceiver}>\n                    <label className=\"block text-sm font-bold tracking-wide text-slate-400 uppercase mb-3\">{t('connCode')}</label>\n                    <div className=\"flex gap-2\">\n                      <input\n                        autoFocus\n                        type=\"text\"\n                        value={receiveCode}\n                        onChange={(e) => setReceiveCode(e.target.value)}\n                        placeholder=\"e.g. abc-xyz#1234\"\n                        className=\"flex-1 bg-black/40 border border-white/10 rounded-xl px-4 py-3 text-white text-center text-xl tracking-widest focus:outline-none focus:border-blue-500/50 transition-colors font-mono\"\n                        maxLength={13}\n                      />\n                      <button\n                        type=\"submit\"\n                        disabled={receiveCode.length < 11}\n                        className=\"bg-blue-600 hover:bg-blue-500 disabled:opacity-50 disabled:cursor-not-allowed text-white px-6 font-bold rounded-xl transition-colors\"\n                      >\n                        {t('connect')}\n                      </button>\n                    </div>\n                    <div className=\"mt-8 flex items-start gap-3 bg-blue-500/5 border border-blue-500/10 p-4 rounded-xl\">\n                      <Shield className=\"w-5 h-5 text-blue-400 mt-0.5 shrink-0\" />\n                      <p className=\"text-xs text-slate-400 leading-relaxed\">\n                        Once connected, files are transferred securely via WebRTC.\n                        The transfer is <strong className=\"text-slate-200\">end-to-end encrypted</strong> and never passes through any storage servers.\n                      </p>\n                    </div>\n                  </form>\n                ) : (\n                  <div className=\"flex flex-col items-center py-4\">\n                    {fileMeta && (\n                      <div className=\"w-full flex items-center gap-4 bg-black/40 border border-white/5 rounded-xl p-4 mb-8\">\n                        <div className=\"w-10 h-10 rounded-lg bg-blue-500/10 flex items-center justify-center shrink-0\">\n                          <FileIcon className=\"w-5 h-5 text-blue-500\" />\n                        </div>\n                        <div className=\"flex-1 min-w-0\">\n                          <p className=\"text-white font-bold text-sm truncate\">{fileMeta.name}</p>\n                          <p className=\"text-slate-400 text-xs\">{formatBytes(fileMeta.size)}</p>\n                        </div>\n                      </div>\n                    )}\n\n                    {!fileMeta && transferProgress === 0 && !errorStatus && (\n                      <div className=\"flex items-center gap-3 text-blue-500/80 mb-6\">\n                        <Loader2 className=\"w-5 h-5 animate-spin\" />\n                        <span className=\"font-mono animate-pulse\">Connecting to sender & requesting file...</span>\n                      </div>\n                    )}\n\n                    {fileMeta && transferProgress >= 0 && transferProgress < 100 && (\n                      <div className=\"w-full\">\n                        <div className=\"flex justify-between text-sm mb-2 font-mono\">\n                          <span className=\"text-blue-500 font-bold animate-pulse\">Decrypting & Receiving... ­şöÉ</span>\n                          <span className=\"text-slate-300\"><AnimatedCounter value={transferProgress} /></span>\n                        </div>\n                        <div className=\"w-full h-3 bg-white/5 rounded-full overflow-hidden border border-white/5\">\n                          <div\n                            className=\"h-full bg-gradient-to-r from-blue-600 to-blue-400 rounded-full transition-all duration-300 ease-out\"\n                            style={{ width: `${transferProgress}%` }}\n                          />\n                        </div>\n                      </div>\n                    )}\n\n                    {transferProgress >= 100 && completedFile && (\n                      <div className=\"text-center mt-2\">\n                        <div className=\"w-16 h-16 rounded-full bg-green-500/20 flex items-center justify-center mx-auto mb-4\">\n                          <Check className=\"w-8 h-8 text-green-500\" />\n                        </div>\n                        <p className=\"text-green-500 font-bold text-xl mb-1\">{t('complete')}</p>\n                        <p className=\"text-slate-400 text-sm mb-2\">{t('readySave')}</p>\n                        {selfDestructSec > 0 && (\n                          <div className=\"mb-4 flex items-center justify-center gap-2 text-red-400 text-xs font-mono animate-pulse\">\n                            <Bomb className=\"w-3 h-3\" /> {t('selfDestruct')} {selfDestructSec}s\n                          </div>\n                        )}\n\n                        <button\n                          onClick={async () => {\n                            try {\n                              if ('showSaveFilePicker' in window) {\n                                const handle = await (window as any).showSaveFilePicker({\n                                  suggestedName: completedFile.name,\n                                });\n                                const writable = await handle.createWritable();\n                                await writable.write(completedFile.blob);\n                                await writable.close();\n                                return; // Success! IDM bypassed completely.\n                              }\n                            } catch (err: any) {\n                              if (err.name !== 'AbortError') {\n                                console.error('SaveFilePicker error:', err);\n                              }\n                              return; // If user cancelled the picker loop, stop here.\n                            }\n\n                            // Legacy fallback if File System API is not available\n                            const url = URL.createObjectURL(completedFile.blob);\n                            const a = document.createElement('a');\n                            a.style.display = 'none';\n                            a.href = url;\n                            a.download = completedFile.name;\n                            document.body.appendChild(a);\n                            a.click();\n                            setTimeout(() => {\n                              document.body.removeChild(a);\n                              URL.revokeObjectURL(url);\n                            }, 100);\n                          }}\n                          className=\"bg-green-600 hover:bg-green-500 text-white font-bold py-3 px-6 w-full max-w-sm rounded-xl transition-all shadow-lg shadow-green-500/20 hover:shadow-green-500/40 flex items-center justify-center mx-auto gap-2 group cursor-pointer\"\n                        >\n                          <Download className=\"w-5 h-5 shrink-0 group-hover:scale-110 transition-transform\" />\n                          <span className=\"truncate max-w-[200px] sm:max-w-[300px]\">{t('save')} {completedFile.name}</span>\n                        </button>\n\n                        {/* Video Stream Button */}\n                        {videoPreviewUrl && (\n                          <div className=\"mt-4 w-full max-w-sm mx-auto\">\n                            {!showVideoPlayer ? (\n                              <button onClick={() => setShowVideoPlayer(true)} className=\"w-full bg-purple-600 hover:bg-purple-500 text-white font-bold py-3 px-6 rounded-xl transition-all flex items-center justify-center gap-2 group cursor-pointer\">\n                                <Play className=\"w-5 h-5 group-hover:scale-110 transition-transform\" />\n                                {t('streamPlay')}\n                              </button>\n                            ) : (\n                              <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} className=\"rounded-xl overflow-hidden border border-purple-500/30 shadow-lg shadow-purple-500/10\">\n                                <div className=\"bg-black/60 p-2 text-xs text-purple-400 font-mono flex items-center gap-2\">\n                                  <Radio className=\"w-3 h-3 animate-pulse\" /> {t('streamTitle')}\n                                </div>\n                                <video src={videoPreviewUrl} controls autoPlay className=\"w-full max-h-60 bg-black\" />\n                              </motion.div>\n                            )}\n                          </div>\n                        )}\n\n                        {/* Swarm Mode */}\n                        <div className=\"mt-4 w-full max-w-sm mx-auto\">\n                          {!isSeeding ? (\n                            <button onClick={becomeSeeder} className=\"w-full bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 text-white font-bold py-3 px-6 rounded-xl transition-all flex items-center justify-center gap-2 group cursor-pointer shadow-lg shadow-cyan-500/10\">\n                              <Radio className=\"w-5 h-5 group-hover:scale-110 transition-transform\" />\n                              {t('beSeeder')}\n                            </button>\n                          ) : (\n                            <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} className=\"bg-cyan-500/10 border border-cyan-500/20 rounded-xl p-4 text-center\">\n                              <div className=\"flex items-center justify-center gap-2 mb-2\">\n                                <Radio className=\"w-4 h-4 text-cyan-400 animate-pulse\" />\n                                <span className=\"text-cyan-400 font-bold text-sm\">{t('swarmMode')}</span>\n                              </div>\n                              <p className=\"text-slate-400 text-xs mb-2\">{t('seeding')}</p>\n                              {swarmPeerCount > 0 && (\n                                <div className=\"flex items-center justify-center gap-2 text-xs text-cyan-400 font-mono\">\n                                  <Users className=\"w-3 h-3\" /> {swarmPeerCount} {t('peers')}\n                                </div>\n                              )}\n                            </motion.div>\n                          )}\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                )}\n              </div>\n            </motion.div>\n          )}\n        </AnimatePresence>\n\n        {/* Ghost Chat Panel */}\n        {mode !== 'idle' && (\n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            className={`mt-6 glass-panel overflow-hidden border ${isConnected ? 'border-purple-500/30 shadow-[0_0_20px_rgba(168,85,247,0.15)]' : 'border-white/10 opacity-70'} relative transition-all duration-500`}\n          >\n            {!isConnected && (\n              <div className=\"absolute inset-0 z-10 bg-black/60 backdrop-blur-[2px] flex items-center justify-center\">\n                <div className=\"flex items-center gap-2 text-white/70 font-mono text-sm\">\n                  <Loader2 className=\"w-4 h-4 animate-spin text-purple-500\" />\n                  Waiting for peer...\n                </div>\n              </div>\n            )}\n            <div className=\"bg-black/40 p-3 border-b border-white/5 flex items-center justify-between\">\n              <div className=\"flex items-center gap-2 text-slate-300 font-bold text-sm\">\n                <MessageSquare className=\"w-4 h-4 text-purple-500\" />\n                {t('ghostChat')}\n              </div>\n              <div className=\"flex items-center gap-1 text-[10px] text-purple-500/80 uppercase tracking-widest bg-purple-500/10 px-2 py-1 rounded-md\">\n                <Lock className=\"w-3 h-3\" /> {t('secure')}\n              </div>\n            </div>\n\n            <div className=\"h-48 overflow-y-auto p-4 flex flex-col gap-3 scrollbar-hide\">\n              {chatMessages.length === 0 ? (\n                <div className=\"h-full flex items-center justify-center text-slate-500 text-sm p-4 text-center italic\">\n                  {t('chatEmpty')}\n                </div>\n              ) : (\n                chatMessages.map(msg => (\n                  <div key={msg.id} className={`max-w-[85%] rounded-xl p-3 text-sm ${msg.sender === 'me' ? 'bg-purple-600/20 text-purple-100 self-end border border-purple-500/20 rounded-tr-sm' : 'bg-black/50 text-slate-300 self-start border border-white/5 rounded-tl-sm shadow-md'}`}>\n                    {msg.text}\n                  </div>\n                ))\n              )}\n              <div ref={chatEndRef} />\n            </div>\n\n            <form onSubmit={sendChatMessage} className=\"p-3 bg-black/40 border-t border-white/5 flex gap-2 relative\">\n              {/* Emoji Picker */}\n              <AnimatePresence>\n                {showEmojiPicker && (\n                  <motion.div initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 10 }} className=\"absolute bottom-full left-3 mb-2 bg-black/90 border border-white/10 rounded-xl p-2 flex gap-1 flex-wrap max-w-[200px] shadow-xl\">\n                    {EMOJIS.map(e => (\n                      <button key={e} type=\"button\" onClick={() => sendEmoji(e)} className=\"text-xl p-1.5 hover:bg-white/10 rounded-lg transition-colors\">{e}</button>\n                    ))}\n                  </motion.div>\n                )}\n              </AnimatePresence>\n              <button type=\"button\" onClick={() => setShowEmojiPicker(!showEmojiPicker)} className=\"text-slate-400 hover:text-purple-400 p-2 rounded-lg transition-colors shrink-0\" title=\"Emoji\">\n                <Smile className=\"w-4 h-4\" />\n              </button>\n              <button type=\"button\" onClick={sendClipboard} className=\"text-slate-400 hover:text-purple-400 p-2 rounded-lg transition-colors shrink-0\" title=\"Paste from Clipboard\">\n                <Clipboard className=\"w-4 h-4\" />\n              </button>\n              <input\n                type=\"text\"\n                value={chatInput}\n                onChange={e => setChatInput(e.target.value)}\n                placeholder=\"Type a secure message...\"\n                className=\"flex-1 bg-black/40 border border-white/10 rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-purple-500/50 transition-colors\"\n                maxLength={200}\n              />\n              <button\n                type=\"submit\"\n                disabled={!chatInput.trim()}\n                className=\"bg-purple-600 hover:bg-purple-500 disabled:opacity-50 text-white p-2 rounded-lg transition-colors flex items-center justify-center w-10 shrink-0\"\n              >\n                <Send className=\"w-4 h-4\" />\n              </button>\n            </form>\n          </motion.div>\n        )}\n\n        {/* Nearby Devices Panel */}\n        <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} className=\"mt-6\">\n          <button onClick={() => setShowNearby(!showNearby)} className=\"w-full flex items-center justify-center gap-2 text-sm text-slate-400 hover:text-white transition-colors py-2 group\">\n            <Wifi className={`w-4 h-4 ${nearbyDevices.length > 0 ? 'text-green-500 animate-pulse' : 'text-slate-500'}`} />\n            {t('nearby')} {nearbyDevices.length > 0 && <span className=\"bg-green-500/20 text-green-400 text-xs px-2 py-0.5 rounded-full font-mono\">{nearbyDevices.length}</span>}\n          </button>\n          <AnimatePresence>\n            {showNearby && (\n              <motion.div initial={{ opacity: 0, height: 0 }} animate={{ opacity: 1, height: 'auto' }} exit={{ opacity: 0, height: 0 }} className=\"overflow-hidden\">\n                <div className=\"glass-panel p-4 mt-2\">\n                  {nearbyDevices.length === 0 ? (\n                    <p className=\"text-sm text-slate-500 text-center italic\">{t('noNearby')}</p>\n                  ) : (\n                    <div className=\"space-y-2\">\n                      {nearbyDevices.map(d => (\n                        <div key={d.id} className=\"flex items-center gap-3 bg-black/30 border border-white/5 rounded-xl p-3\">\n                          <div className=\"w-8 h-8 rounded-full bg-green-500/10 flex items-center justify-center\">\n                            <Wifi className=\"w-4 h-4 text-green-500\" />\n                          </div>\n                          <div className=\"flex-1 min-w-0\">\n                            <p className=\"text-white text-sm font-bold\">{d.name}</p>\n                            <p className=\"text-slate-500 text-xs font-mono truncate\">{d.code ? `Room: ${d.code.split('#')[0]}` : 'Idle'}</p>\n                          </div>\n                          {d.code ? (\n                            <button\n                              onClick={() => connectToDevice(d.code!)}\n                              className=\"bg-green-600 hover:bg-green-500 text-white text-xs font-bold px-4 py-2 rounded-lg transition-colors flex items-center gap-1.5 shrink-0\"\n                            >\n                              <Download className=\"w-3 h-3\" /> {t('sendTo')}\n                            </button>\n                          ) : (\n                            <div className=\"w-2 h-2 bg-green-500 rounded-full animate-pulse\" />\n                          )}\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                </div>\n              </motion.div>\n            )}\n          </AnimatePresence>\n        </motion.div>\n\n        <div className=\"mt-8 text-center text-xs text-slate-600 flex items-center justify-center gap-2\">\n          <Shield className=\"w-4 h-4\" /> {t('footer')}\n        </div>\n\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\pc\\Desktop\\projelerim\\mephisto-share\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\pc\\Desktop\\projelerim\\mephisto-share\\vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
